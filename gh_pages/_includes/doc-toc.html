<nav class="doc-toc">
  <div class="doc-toc-header">
    <h3>On This Page</h3>
  </div>
  <ul class="doc-toc-list" id="doc-toc-list">
    <!-- JavaScript will populate this -->
  </ul>
</nav>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const content = document.querySelector('.doc-content');
  const tocList = document.getElementById('doc-toc-list');

  if (!content || !tocList) return;

  // Get only H2 headings
  const headings = content.querySelectorAll('h2');

  if (headings.length === 0) {
    // Hide TOC if no H2 headings found
    const tocNav = document.querySelector('.doc-toc');
    if (tocNav) {
      tocNav.style.display = 'none';
    }
    return;
  }

  headings.forEach((heading, index) => {
    // Create an ID if it doesn't exist
    if (!heading.id) {
      heading.id = 'heading-' + index;
    }

    // Create list item
    const li = document.createElement('li');

    // Create link
    const a = document.createElement('a');
    a.href = '#' + heading.id;
    a.textContent = heading.textContent;
    a.className = 'toc-link';

    li.appendChild(a);
    tocList.appendChild(li);
  });

  // Highlight current section on scroll
  const observerOptions = {
    rootMargin: '-100px 0px -66%',
    threshold: 0
  };

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      const id = entry.target.id;
      const tocLink = document.querySelector(`.toc-link[href="#${id}"]`);

      if (tocLink) {
        if (entry.isIntersecting) {
          // Remove active class from all links
          document.querySelectorAll('.toc-link').forEach(link => {
            link.classList.remove('active');
          });
          // Add active class to current link
          tocLink.classList.add('active');
        }
      }
    });
  }, observerOptions);

  // Observe all headings
  headings.forEach(heading => {
    observer.observe(heading);
  });

  // Smooth scroll for TOC links
  document.querySelectorAll('.toc-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        const offsetTop = target.offsetTop - 100;
        window.scrollTo({
          top: offsetTop,
          behavior: 'smooth'
        });

        // Close mobile TOC after clicking
        const sidebar = document.querySelector('.doc-sidebar');
        if (sidebar && window.innerWidth < 1024) {
          sidebar.classList.remove('mobile-open');
        }
      }
    });
  });
});
</script>
