<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>PLC Library Usage | Event Video Playback</title>
  <meta name="description" content="Complete guide to using Event Video Playback function blocks in your TwinCAT PLC projects">

  <link rel="stylesheet" href="/EventVideoPlayback/assets/css/style.css">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>PLC Library Usage | Event Video Playback</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="PLC Library Usage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Complete guide to using Event Video Playback function blocks in your TwinCAT PLC projects" />
<meta property="og:description" content="Complete guide to using Event Video Playback function blocks in your TwinCAT PLC projects" />
<link rel="canonical" href="http://localhost:4000/EventVideoPlayback/docs/plc-usage/" />
<meta property="og:url" content="http://localhost:4000/EventVideoPlayback/docs/plc-usage/" />
<meta property="og:site_name" content="Event Video Playback" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-11-11T07:46:24-08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PLC Library Usage" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-11-11T07:46:24-08:00","datePublished":"2025-11-11T07:46:24-08:00","description":"Complete guide to using Event Video Playback function blocks in your TwinCAT PLC projects","headline":"PLC Library Usage","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/EventVideoPlayback/docs/plc-usage/"},"url":"http://localhost:4000/EventVideoPlayback/docs/plc-usage/"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="header-content">
      <a class="site-title" href="/EventVideoPlayback/">
        Event Video Playback
      </a>
      <nav class="site-nav">
        <button class="mobile-menu-toggle" aria-label="Toggle menu">‚ò∞</button>
        <a href="/EventVideoPlayback/">Home</a>
        <a href="/EventVideoPlayback/docs/getting-started/">Getting Started</a>
        <a href="/EventVideoPlayback/docs/plc-usage/">PLC Library</a>
        <a href="/EventVideoPlayback/docs/service-config/">Service Config</a>
        <a href="/EventVideoPlayback/docs/hmi-usage/">HMI Usage</a>
        <a href="https://github.com/Beckhoff-USA-Community/EventVideoPlayback" target="_blank" class="btn btn-ghost" style="margin-left: 1rem;">GitHub</a>
      </nav>
    </div>
  </div>
</header>


  <main class="main-content">
    <div class="section doc-section" style="background-color: #f8f8f8; min-height: calc(100vh - 70px);">
  <div class="container">
    <!-- Mobile TOC Toggle -->
    <button class="doc-toc-mobile-toggle" id="mobile-toc-toggle">
      <span>üìë Table of Contents</span>
    </button>

    <div class="doc-layout">
      <!-- Table of Contents Sidebar -->
      <aside class="doc-sidebar" id="doc-sidebar">
        <nav class="doc-toc">
  <div class="doc-toc-header">
    <h3>On This Page</h3>
  </div>
  <ul class="doc-toc-list" id="doc-toc-list">
    <!-- JavaScript will populate this -->
  </ul>
</nav>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const content = document.querySelector('.doc-content');
  const tocList = document.getElementById('doc-toc-list');

  if (!content || !tocList) return;

  // Get only H2 headings
  const headings = content.querySelectorAll('h2');

  if (headings.length === 0) {
    // Hide TOC if no H2 headings found
    const tocNav = document.querySelector('.doc-toc');
    if (tocNav) {
      tocNav.style.display = 'none';
    }
    return;
  }

  headings.forEach((heading, index) => {
    // Create an ID if it doesn't exist
    if (!heading.id) {
      heading.id = 'heading-' + index;
    }

    // Create list item
    const li = document.createElement('li');

    // Create link
    const a = document.createElement('a');
    a.href = '#' + heading.id;
    a.textContent = heading.textContent;
    a.className = 'toc-link';

    li.appendChild(a);
    tocList.appendChild(li);
  });

  // Highlight current section on scroll
  const observerOptions = {
    rootMargin: '-100px 0px -66%',
    threshold: 0
  };

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      const id = entry.target.id;
      const tocLink = document.querySelector(`.toc-link[href="#${id}"]`);

      if (tocLink) {
        if (entry.isIntersecting) {
          // Remove active class from all links
          document.querySelectorAll('.toc-link').forEach(link => {
            link.classList.remove('active');
          });
          // Add active class to current link
          tocLink.classList.add('active');
        }
      }
    });
  }, observerOptions);

  // Observe all headings
  headings.forEach(heading => {
    observer.observe(heading);
  });

  // Smooth scroll for TOC links
  document.querySelectorAll('.toc-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        const offsetTop = target.offsetTop - 100;
        window.scrollTo({
          top: offsetTop,
          behavior: 'smooth'
        });

        // Close mobile TOC after clicking
        const sidebar = document.querySelector('.doc-sidebar');
        if (sidebar && window.innerWidth < 1024) {
          sidebar.classList.remove('mobile-open');
        }
      }
    });
  });
});
</script>

      </aside>

      <!-- Main Content -->
      <div class="doc-main">
        <div class="doc-card">
          
          <h1>PLC Library Usage</h1>
          

          
          <p class="doc-meta">Complete guide to using Event Video Playback function blocks in your TwinCAT PLC projects</p>
          

          <!-- PDF Download Button -->
          
          

          
          <div class="doc-download-section">
            <a href="/EventVideoPlayback/assets/pdf/plc-usage.pdf" class="btn-download-pdf" download>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Download as PDF
            </a>
            <a href="/EventVideoPlayback/assets/pdf/complete-documentation.pdf" class="btn-download-pdf btn-download-complete" download>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="12" y1="18" x2="12" y2="12"></line>
                <line x1="9" y1="15" x2="15" y2="15"></line>
              </svg>
              Download Complete Docs
            </a>
          </div>
          

          <div class="doc-content">
            <h2 id="overview">Overview</h2>

<p>The Event Video Playback PLC library provides easy-to-use function blocks for integrating event-driven video recording into your TwinCAT applications. This guide covers the complete API and usage patterns.</p>

<h2 id="library-reference">Library Reference</h2>

<h3 id="adding-the-library">Adding the Library</h3>

<p>In your TwinCAT PLC project:</p>

<ol>
  <li>Right-click on <strong>References</strong></li>
  <li>Select <strong>Add Library</strong></li>
  <li>Search for ‚ÄúEventVideoPlayback‚Äù</li>
  <li>Select the library and click <strong>OK</strong></li>
</ol>

<p>The library will now be available for use in your PLC programs.</p>

<h2 id="core-function-blocks">Core Function Blocks</h2>

<h3 id="fb_eventvideorecorder">FB_EventVideoRecorder</h3>

<p>The main function block for recording event-driven videos from TwinCAT Vision images.</p>

<h4 id="declaration">Declaration</h4>

<pre><code class="language-iecst">VAR
    fbVideoRecorder : FB_EventVideoRecorder;
END_VAR
</code></pre>

<h4 id="input-parameters">Input Parameters</h4>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sVideoName</code></td>
      <td>STRING</td>
      <td>Unique name for the video file</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bExecute</code></td>
      <td>BOOL</td>
      <td>Rising edge triggers video creation</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">tPreEventTime</code></td>
      <td>TIME</td>
      <td>Duration of pre-event video to include (default: 10s)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">tPostEventTime</code></td>
      <td>TIME</td>
      <td>Duration of post-event video to include (default: 5s)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sImagePath</code></td>
      <td>STRING</td>
      <td>Path to TwinCAT Vision image folder</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bLogToEventLogger</code></td>
      <td>BOOL</td>
      <td>Enable automatic Event Logger integration</td>
    </tr>
  </tbody>
</table>

<h4 id="output-parameters">Output Parameters</h4>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bDone</code></td>
      <td>BOOL</td>
      <td>TRUE when video creation is complete</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bBusy</code></td>
      <td>BOOL</td>
      <td>TRUE while video is being created</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bError</code></td>
      <td>BOOL</td>
      <td>TRUE if an error occurred</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">nErrorID</code></td>
      <td>UDINT</td>
      <td>Error code (0 = no error)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sVideoPath</code></td>
      <td>STRING</td>
      <td>Full path to the created video file</td>
    </tr>
  </tbody>
</table>

<h4 id="usage-example">Usage Example</h4>

<pre><code class="language-iecst">PROGRAM MAIN
VAR
    fbVideoRecorder : FB_EventVideoRecorder;
    bMachineError   : BOOL;
    bEventTriggered : BOOL;
    sEventName      : STRING(255);
END_VAR

// Detect machine error event
IF bMachineError AND NOT bEventTriggered THEN
    bEventTriggered := TRUE;
    sEventName := CONCAT('MachineError_', TO_STRING(NOW()));
END_IF

// Record video on event
fbVideoRecorder(
    sVideoName := sEventName,
    bExecute := bEventTriggered,
    tPreEventTime := T#15S,  // 15 seconds before event
    tPostEventTime := T#10S,  // 10 seconds after event
    sImagePath := 'C:\TwinCAT\Vision\Images',
    bLogToEventLogger := TRUE
);

// Reset trigger when done
IF fbVideoRecorder.bDone OR fbVideoRecorder.bError THEN
    bEventTriggered := FALSE;
END_IF

// Handle errors
IF fbVideoRecorder.bError THEN
    // Log error code: fbVideoRecorder.nErrorID
    // Take corrective action
END_IF
</code></pre>

<h2 id="advanced-usage-patterns">Advanced Usage Patterns</h2>

<h3 id="multiple-event-types">Multiple Event Types</h3>

<p>Handle different types of events with separate video recordings:</p>

<pre><code class="language-iecst">PROGRAM MAIN
VAR
    fbVideoQuality    : FB_EventVideoRecorder;
    fbVideoMaintenance : FB_EventVideoRecorder;
    fbVideoSafety     : FB_EventVideoRecorder;

    bQualityIssue     : BOOL;
    bMaintenanceNeeded : BOOL;
    bSafetyEvent      : BOOL;
END_VAR

// Quality issue recording
fbVideoQuality(
    sVideoName := 'QualityIssue_' + TO_STRING(NOW()),
    bExecute := bQualityIssue,
    tPreEventTime := T#20S,
    bLogToEventLogger := TRUE
);

// Maintenance event recording
fbVideoMaintenance(
    sVideoName := 'Maintenance_' + TO_STRING(NOW()),
    bExecute := bMaintenanceNeeded,
    tPreEventTime := T#30S,
    bLogToEventLogger := TRUE
);

// Safety event recording
fbVideoSafety(
    sVideoName := 'Safety_' + TO_STRING(NOW()),
    bExecute := bSafetyEvent,
    tPreEventTime := T#60S,
    tPostEventTime := T#30S,
    bLogToEventLogger := TRUE
);
</code></pre>

<h3 id="conditional-recording">Conditional Recording</h3>

<p>Record videos only under specific conditions:</p>

<pre><code class="language-iecst">VAR
    fbVideoRecorder : FB_EventVideoRecorder;
    bEventOccurred  : BOOL;
    bRecordEnabled  : BOOL := TRUE;
    nEventSeverity  : UINT;
    nMinSeverity    : UINT := 5;  // Only record severity &gt;= 5
END_VAR

// Only record if enabled and severity threshold met
IF bEventOccurred AND bRecordEnabled AND (nEventSeverity &gt;= nMinSeverity) THEN
    fbVideoRecorder(
        sVideoName := CONCAT('Event_Severity_', TO_STRING(nEventSeverity)),
        bExecute := TRUE,
        bLogToEventLogger := TRUE
    );
END_IF
</code></pre>

<h3 id="sequence-recording">Sequence Recording</h3>

<p>Record a sequence of related events:</p>

<pre><code class="language-iecst">TYPE E_RecordingState :
(
    IDLE,
    RECORDING,
    WAITING_FOR_NEXT,
    COMPLETE
);
END_TYPE

VAR
    fbVideoRecorder   : FB_EventVideoRecorder;
    eState            : E_RecordingState := IDLE;
    nSequenceCount    : UINT := 0;
    nMaxSequences     : UINT := 5;
    bStartSequence    : BOOL;
END_VAR

CASE eState OF
    IDLE:
        IF bStartSequence THEN
            nSequenceCount := 0;
            eState := RECORDING;
        END_IF

    RECORDING:
        fbVideoRecorder(
            sVideoName := CONCAT('Sequence_', TO_STRING(nSequenceCount)),
            bExecute := TRUE
        );

        IF fbVideoRecorder.bDone THEN
            nSequenceCount := nSequenceCount + 1;

            IF nSequenceCount &gt;= nMaxSequences THEN
                eState := COMPLETE;
            ELSE
                eState := WAITING_FOR_NEXT;
            END_IF
        END_IF

    WAITING_FOR_NEXT:
        // Wait for condition to trigger next recording
        IF bTriggerNextRecording THEN
            eState := RECORDING;
        END_IF

    COMPLETE:
        // All sequences recorded
        eState := IDLE;
END_CASE
</code></pre>

<h2 id="error-handling">Error Handling</h2>

<h3 id="error-codes">Error Codes</h3>

<table>
  <thead>
    <tr>
      <th>Error ID</th>
      <th>Description</th>
      <th>Resolution</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>No error</td>
      <td>N/A</td>
    </tr>
    <tr>
      <td>1001</td>
      <td>Service not available</td>
      <td>Check if EventVideoPlayback service is running</td>
    </tr>
    <tr>
      <td>1002</td>
      <td>Invalid image path</td>
      <td>Verify sImagePath is correct</td>
    </tr>
    <tr>
      <td>1003</td>
      <td>Insufficient images</td>
      <td>Ensure Vision system is capturing images</td>
    </tr>
    <tr>
      <td>1004</td>
      <td>Video creation failed</td>
      <td>Check service logs for details</td>
    </tr>
    <tr>
      <td>1005</td>
      <td>Disk space insufficient</td>
      <td>Free up disk space</td>
    </tr>
    <tr>
      <td>1006</td>
      <td>Invalid parameters</td>
      <td>Check input parameter values</td>
    </tr>
  </tbody>
</table>

<h3 id="error-handling-example">Error Handling Example</h3>

<pre><code class="language-iecst">VAR
    fbVideoRecorder : FB_EventVideoRecorder;
    sErrorMessage   : STRING(255);
END_VAR

IF fbVideoRecorder.bError THEN
    CASE fbVideoRecorder.nErrorID OF
        1001:
            sErrorMessage := 'EventVideoPlayback service is not running';
            // Attempt to restart service or notify maintenance

        1002:
            sErrorMessage := 'Invalid image path configured';
            // Log configuration error

        1003:
            sErrorMessage := 'Not enough images available for video';
            // Check Vision system status

        1004:
            sErrorMessage := 'Video creation failed';
            // Check service logs and disk space

        1005:
            sErrorMessage := 'Insufficient disk space';
            // Trigger cleanup or notification

        ELSE:
            sErrorMessage := CONCAT('Unknown error: ', TO_STRING(fbVideoRecorder.nErrorID));
    END_CASE

    // Log error to Event Logger or HMI
END_IF
</code></pre>

<h2 id="best-practices">Best Practices</h2>

<h3 id="1-unique-video-names">1. Unique Video Names</h3>

<p>Always use unique video names to avoid conflicts:</p>

<pre><code class="language-iecst">// Good: Include timestamp
sVideoName := CONCAT('Event_', TO_STRING(NOW()));

// Better: Include machine ID and event type
sVideoName := CONCAT('Machine01_QualityIssue_', TO_STRING(NOW()));
</code></pre>

<h3 id="2-appropriate-time-windows">2. Appropriate Time Windows</h3>

<p>Choose pre/post event times based on your needs:</p>

<ul>
  <li><strong>Fast events</strong> (&lt; 1 second): Use 5-10 seconds pre-event</li>
  <li><strong>Slow events</strong> (&gt; 10 seconds): Use 30-60 seconds pre-event</li>
  <li><strong>Post-event</strong>: Usually 5-10 seconds is sufficient</li>
</ul>

<h3 id="3-resource-management">3. Resource Management</h3>

<p>Don‚Äôt create videos too frequently:</p>

<pre><code class="language-iecst">VAR
    fbVideoRecorder    : FB_EventVideoRecorder;
    tLastRecording     : TIME;
    tMinInterval       : TIME := T#30S;  // Minimum 30s between recordings
END_VAR

IF (TIME() - tLastRecording) &gt; tMinInterval THEN
    // Allow recording
    tLastRecording := TIME();
END_IF
</code></pre>

<h3 id="4-event-logger-integration">4. Event Logger Integration</h3>

<p>Enable Event Logger integration for automatic correlation:</p>

<pre><code class="language-iecst">fbVideoRecorder(
    sVideoName := sEventName,
    bExecute := bEvent,
    bLogToEventLogger := TRUE  // Automatically creates Event Logger entry
);
</code></pre>

<h2 id="performance-considerations">Performance Considerations</h2>

<ul>
  <li><strong>Image Buffer</strong>: The service maintains a rolling buffer of images</li>
  <li><strong>CPU Usage</strong>: Video encoding is performed by the service, not PLC</li>
  <li><strong>Network Impact</strong>: Minimal - only ADS communication for commands</li>
  <li><strong>Disk I/O</strong>: Configure video output path on fast storage</li>
</ul>

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li>Configure <a href="/EventVideoPlayback/docs/service-config/">Service Settings</a> for optimal performance</li>
  <li>Add <a href="/EventVideoPlayback/docs/hmi-usage/">HMI Controls</a> for video playback</li>
  <li>Review <a href="/EventVideoPlayback/docs/getting-started/">Getting Started</a> for installation help</li>
</ul>

          </div>

          <hr style="margin-top: 4rem; margin-bottom: 2rem;">

          <div style="text-align: center;">
            <a href="/EventVideoPlayback/" class="btn btn-primary">‚Üê Back to Home</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Mobile TOC toggle
document.addEventListener('DOMContentLoaded', function() {
  const toggle = document.getElementById('mobile-toc-toggle');
  const sidebar = document.getElementById('doc-sidebar');

  if (toggle && sidebar) {
    toggle.addEventListener('click', function() {
      sidebar.classList.toggle('mobile-open');
      toggle.classList.toggle('open');
    });

    // Close sidebar when clicking outside
    document.addEventListener('click', function(e) {
      if (window.innerWidth < 1024) {
        if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
          sidebar.classList.remove('mobile-open');
          toggle.classList.remove('open');
        }
      }
    });
  }
});
</script>


  </main>

  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Event Video Playback</h3>
        <p>Transform TwinCAT Vision images into event-driven video recordings for industrial automation.</p>
      </div>

      <div class="footer-section">
        <h3>Documentation</h3>
        <ul>
          <li><a href="/EventVideoPlayback/docs/getting-started/">Getting Started</a></li>
          <li><a href="/EventVideoPlayback/docs/plc-usage/">PLC Library Usage</a></li>
          <li><a href="/EventVideoPlayback/docs/service-config/">Service Configuration</a></li>
          <li><a href="/EventVideoPlayback/docs/hmi-usage/">HMI User Control</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3>Resources</h3>
        <ul>
          <li><a href="https://github.com/Beckhoff-USA-Community/EventVideoPlayback" target="_blank">GitHub Repository</a></li>
          <li><a href="https://packages.beckhoff-usa-community.com/" target="_blank">Package Feed</a></li>
          <li><a href="https://github.com/Beckhoff-USA-Community/EventVideoPlayback/issues" target="_blank">Report Issues</a></li>
          <li><a href="https://github.com/Beckhoff-USA-Community" target="_blank">Beckhoff USA Community</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3>Community</h3>
        <ul>
          <li><a href="https://github.com/Beckhoff-USA-Community" target="_blank">Beckhoff USA Community</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 Beckhoff USA Community | Licensed under MIT License</p>
    </div>
  </div>
</footer>


  <script src="/EventVideoPlayback/assets/js/main.js"></script>
</body>
</html>
